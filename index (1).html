<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Purchase & Income Record System</title>
  <script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-auth-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-firestore-compat.js"></script>
  <style>
    body { font-family: Arial, sans-serif; padding: 20px; background: #f5f5f5; }
    .container { max-width: 1000px; margin: auto; background: white; padding: 20px; border-radius: 8px; box-shadow: 0 0 10px rgba(0,0,0,0.1); }
    input, select, textarea, button { width: 100%; padding: 10px; margin: 8px 0; border: 1px solid #ccc; border-radius: 5px; }
    table { width: 100%; border-collapse: collapse; margin-top: 20px; }
    table, th, td { border: 1px solid #ddd; }
    th, td { padding: 10px; text-align: left; }
    .btn { background: #3498db; color: white; border: none; cursor: pointer; }
    .btn-logout { background: #e74c3c; }
    .btn-export { background: #2ecc71; }
    .link { color: #3498db; cursor: pointer; text-decoration: underline; }
  </style>
</head>
<body>
  <div class="container">
    <h2>Purchase & Income Record System (Admin Controlled)</h2>
    <div id="authSection">
      <input type="email" id="authEmail" placeholder="Email" />
      <input type="password" id="authPassword" placeholder="Password" />
      <button class="btn" onclick="login()">Login</button>
      <button class="btn" onclick="showSignup()">Sign Up</button>
      <p><span class="link" onclick="showPasswordReset()">Forgot Password?</span></p>
    </div>

    <div id="signupSection" style="display:none;">
      <input type="email" id="signupEmail" placeholder="Email" />
      <input type="password" id="signupPassword" placeholder="Password" />
      <select id="signupRole">
        <option value="user">User</option>
        <option value="admin">Admin</option>
      </select>
      <button class="btn" onclick="signup()">Create Account</button>
    </div>

    <div id="resetPasswordSection" style="display:none;">
      <input type="email" id="resetEmail" placeholder="Enter your email" />
      <button class="btn" onclick="resetPassword()">Send Reset Email</button>
    </div>

    <div id="mainSection" style="display:none;">
      <div>
        <span id="userInfo"></span>
        <button class="btn btn-logout" onclick="logout()">Logout</button>
      </div>
      <hr />
      <div>
        <button class="btn" onclick="openPage('purchase')">Purchase Page</button>
        <button class="btn" onclick="openPage('income')">Income Page</button>
      </div>
    </div>

    <div id="purchaseSection" style="display:none;">
      <h3>Purchase Record</h3>
      <input type="text" id="buyerInput" placeholder="Buyer Name">
      <input type="text" id="product" placeholder="Product Name">
      <input type="number" id="quantity" placeholder="Quantity">
      <select id="unit">
        <option value="pcs">pcs</option>
        <option value="kg">kg</option>
        <option value="liters">liters</option>
      </select>
      <input type="number" id="price" placeholder="Price per unit (RWF)">
      <input type="date" id="date">
      <textarea id="comment" placeholder="Comment"></textarea>
      <button class="btn" onclick="addPurchase()">Add Purchase</button>
      <table id="purchaseTable"><thead><tr><th>Product</th><th>Qty</th><th>Unit</th><th>Price</th><th>Total</th><th>Buyer</th><th>Date</th><th>Comment</th></tr></thead><tbody></tbody></table>
      <div>Grand Total: <span id="totalAmount">0</span> RWF<br>Total by Buyer: <span id="buyerSummary"></span></div>
    </div>

    <div id="incomeSection" style="display:none;">
      <h3>Income Record</h3>
      <input id="fullName" placeholder="Full Name">
      <input type="number" id="incomeAmount" placeholder="Amount">
      <input type="date" id="incomeDate">
      <textarea id="incomeComment" placeholder="Comment"></textarea>
      <button class="btn" onclick="addIncome()">Add Income</button>
      <table id="incomeTable"><thead><tr><th>Full Name</th><th>Amount</th><th>Date</th><th>Comment</th></tr></thead><tbody></tbody></table>
    </div>
  </div>

<script>
// REPLACE THESE WITH YOUR ACTUAL FIREBASE CONFIG
const firebaseConfig = {
  apiKey: "YOUR_API_KEY",
  authDomain: "YOUR_PROJECT_ID.firebaseapp.com",
  projectId: "YOUR_PROJECT_ID"
};

firebase.initializeApp(firebaseConfig);
const auth = firebase.auth();
const db = firebase.firestore();

let currentUser = null;

function showSignup() {
  document.getElementById('authSection').style.display = 'none';
  document.getElementById('signupSection').style.display = 'block';
}

function signup() {
  const email = document.getElementById('signupEmail').value;
  const password = document.getElementById('signupPassword').value;
  const role = document.getElementById('signupRole').value;
  auth.createUserWithEmailAndPassword(email, password)
    .then(cred => db.collection('users').doc(cred.user.uid).set({ role }))
    .then(() => alert('Signed up successfully'))
    .catch(error => alert(error.message));
}

function login() {
  const email = document.getElementById('authEmail').value;
  const password = document.getElementById('authPassword').value;
  auth.signInWithEmailAndPassword(email, password)
    .then(cred => {
      currentUser = cred.user;
      return db.collection('users').doc(currentUser.uid).get();
    })
    .then(doc => {
      const role = doc.data().role;
      document.getElementById('userInfo').innerHTML = `Logged in as <strong>${email}</strong> [${role}]`;
      document.getElementById('authSection').style.display = 'none';
      document.getElementById('signupSection').style.display = 'none';
      document.getElementById('mainSection').style.display = 'block';
    })
    .catch(err => alert(err.message));
}

function logout() {
  auth.signOut().then(() => location.reload());
}

function resetPassword() {
  const email = document.getElementById('resetEmail').value;
  auth.sendPasswordResetEmail(email)
    .then(() => alert('Reset email sent'))
    .catch(err => alert(err.message));
}

function showPasswordReset() {
  document.getElementById('resetPasswordSection').style.display = 'block';
}

function openPage(page) {
  const timestamp = new Date().toLocaleString();
  db.collection('logs').add({ user: currentUser.email, page, time: timestamp });
  document.getElementById('purchaseSection').style.display = 'none';
  document.getElementById('incomeSection').style.display = 'none';
  document.getElementById(page + 'Section').style.display = 'block';
}

function addPurchase() {
  // Your addPurchase logic here
}

function addIncome() {
  // Your addIncome logic here
}
</script>
</body>
</html>
